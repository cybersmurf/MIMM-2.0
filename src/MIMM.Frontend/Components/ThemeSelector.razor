@using MIMM.Frontend.Services
@inject IThemeService ThemeService
@inject ISnackbar Snackbar

<MudMenu AnchorOrigin="Origin.BottomLeft" TransformOrigin="Origin.TopLeft" Dense>
    <ActivatorContent>
        <MudIconButton 
            Icon="@Icons.Material.Filled.Palette" 
            Color="Color.Inherit"
            aria-label="Theme selector">
        </MudIconButton>
    </ActivatorContent>
    <ChildContent>
        <MudText Typo="Typo.body2" Class="px-4 pt-2" Style="font-weight: 500;">Select Theme</MudText>
        <MudDivider Class="my-2" />
        
        @foreach (var theme in ThemeService.AvailableThemes)
        {
            var metadata = ThemeService.ThemeMetadata[theme];
            var isActive = ThemeService.CurrentTheme == theme;
            
            <MudMenuItem OnClick="@(() => SelectThemeAsync(theme))">
                <MudStack Row AlignItems="AlignItems.Center" Spacing="2" Class="w-100">
                    <MudIcon Icon="@metadata.Icon" />
                    <MudStack Spacing="0" Style="flex: 1;">
                        <MudText Typo="Typo.body2">@metadata.Name</MudText>
                        <MudText Typo="Typo.body2" Style="opacity: 0.8;">@metadata.Description</MudText>
                    </MudStack>
                    @if (isActive)
                    {
                        <MudIcon Icon="@Icons.Material.Filled.Check" Color="Color.Success" />
                    }
                </MudStack>
            </MudMenuItem>
        }
    </ChildContent>
</MudMenu>

@code {
    private async Task SelectThemeAsync(string theme)
    {
        try
        {
            await ThemeService.SetThemeAsync(theme);
            var themeName = ThemeService.ThemeMetadata[theme].Name;
            Snackbar.Add($"Theme changed to {themeName}", Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error changing theme: {ex.Message}", Severity.Error);
        }
    }
}
